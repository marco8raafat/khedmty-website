<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="logoCircle1.png">
  <title>ุฑูุน ุงููุตุงุฏุฑ ุงูุชุนููููุฉ</title>
  <link rel="stylesheet" href="uploadPDF.css">
</head>
<body>
<div class="cross-background"></div>
  <nav class="navbar">
    <div class="nav-left">
      <img src="church-logo.png" alt="Church Logo" class="church-logo">
      <button class="menu-toggle" onclick="toggleMobileMenu()">โฐ</button>
    </div>
    <div class="nav-right" id="navMenu">
      <a href="index.html" class="nav-link">ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</a>
      <a href="teacherDashboard.html" class="nav-link">ููุญุฉ ุงูุชุญูู</a>
      <a href="listPDF.html" class="nav-link">ุนุฑุถ ุงููุตุงุฏุฑ</a>
      <a href="profilepage.html" class="nav-link">ุงูููู ุงูุดุฎุตู</a>
      <a href="javascript:void(0)" onclick="logout()" class="nav-link">ุชุณุฌูู ุงูุฎุฑูุฌ</a>
    </div>
  </nav>

  <div class="container">
    <main>

      <div id="upload" class="tab-content active">
        <h2 class="section-title">ุฑูุน ูุตุฏุฑ ุชุนูููู ุฌุฏูุฏ</h2>
        <div style="background-color: #e8f4fd; border: 1px solid #0066cc; border-radius: 5px; padding: 15px; margin-bottom: 20px; text-align: center;">
          <p style="margin: 0; color: #0066cc; font-weight: bold;">
            ๐ ูุฌุจ ุฑูุน ุงูููู ุฃููุงู ุนูู ูุฐุง ุงููููุน: 
            <a href="https://gofile.io/" target="_blank" style="color: #0066cc; text-decoration: underline;">https://gofile.io/</a>
            <br>
            ุซู ูุณุฎ ุงูุฑุงุจุท ุงููุจุงุดุฑ ููููู ููุตูู ููุง
            <br>
            <span style="color: #ff0000; font-weight: bold;">ููุญูุธุฉ ุตูุงุญูุฉ ุงูููู 10 ุฃูุงู ููุทุ ุจุนุฏ ุฐูู ูุฌุจ ุฑูุนู ูุฑุฉ ุฃุฎุฑู</span>
            <br>
             ุงู ูู ุจุฑูุนู ุจุฏูู ุตูุงุญูุฉ ูู ุฎูุงู :
            <a href="https://drive.google.com/drive/quota" target="_blank" style="color: #0066cc; text-decoration: underline;">google drive</a>
          </p>
        </div>
        <form id="uploadForm">
          <div class="form-group">
            <label for="title">ุงุณู ุงูููู:</label>
            <input type="text" id="title" required>
          </div>
          <div class="form-group">
            <label for="subject">ุงุณู ุงููุงุฏุฉ:</label>
            <input type="text" id="subject" required>
          </div>
          <div class="form-group">
            <label for="pdfLink">ุฑุงุจุท ุงูููู:</label>
            <input type="url" id="pdfLink" placeholder="https://gofile.io/d/0ZKlPi" required>
          </div>
          <button type="submit" class="btn">ุฑูุน ุงููุตุฏุฑ ุงูุชุนูููู</button>
        </form>
        <div id="message"></div>
      </div>

      <div id="pdfList" class="pdf-list">
        <div class="empty-state">
          <p>ูุง ุชูุฌุฏ ูุตุงุฏุฑ ุชุนููููุฉ ูุฑููุนุฉ ุญุงูููุง</p>
        </div>
      </div>
    </main>
  </div>

  <footer>
    ยฉ ูููุณุฉ ุงูุณูุฏุฉ ุงูุนุฐุฑุงุก - ุนุฒุจุฉ ุงููุฎู | ุชุทุจูู ุฎุฏูุชู 2025
  </footer>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="sessionUtils.js"></script>
  
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDwcSo_bhqO5svMl3kAL8N1c91nvEZ_sac",
      authDomain: "edad-5odam.firebaseapp.com",
      databaseURL: "https://edad-5odam-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "edad-5odam",
      storageBucket: "edad-5odam.appspot.com",
      messagingSenderId: "679576633778",
      appId: "1:679576633778:web:566e6aaef9b72f71a824ab"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Authentication check function
    async function checkAuthentication() {
      try {
        const currentUser = await requireAuthentication();
        
        if (!currentUser) {
          alert("ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู ูููุตูู ุฅูู ูุฐู ุงูุตูุญุฉ");
          window.location.href = "login.html";
          return false;
        }

        // Verify user exists in Firebase
        const emailKey = currentUser.replace(/\./g, '_');
        const snapshot = await db.ref('users/' + emailKey).once('value');
        if (!snapshot.exists()) {
          alert("ุฌูุณุฉ ุงููุณุชุฎุฏู ุบูุฑ ุตุงูุญุฉ. ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู");
          clearSession();
          window.location.href = "login.html";
          return false;
        }
        
        const userData = snapshot.val();
        // Check if user is a servant (only servants can upload PDFs)
        if (userData.role !== "servant") {
          alert("ุบูุฑ ูุณููุญ ูู ุจุงููุตูู ุฅูู ูุฐู ุงูุตูุญุฉ. ูุฐู ุงูุตูุญุฉ ูุฎุตุตุฉ ููุฎุฏุงู ููุท");
          window.location.href = userData.role === "student" ? "studentDashboard.html" : "index.html";
          return false;
        }
        
        return true;
        
      } catch (error) {
        console.error("Error verifying user:", error);
        alert("ุญุฏุซ ุฎุทุฃ ูู ุงูุชุญูู ูู ุงููุณุชุฎุฏู. ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู");
        window.location.href = "login.html";
        return false;
      }
    }



    // Initialize page
    async function initializePage() {
      const isAuthenticated = await checkAuthentication();
      if (isAuthenticated) {
        // Initialize upload PDF functionality
        console.log("User authenticated, ready to upload PDFs");
      }
    }

    // Mobile menu toggle function
    function toggleMobileMenu() {
      const navMenu = document.getElementById('navMenu');
      navMenu.classList.toggle('active');
    }

    // Logout function
    function logout() {
      if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุชุณุฌูู ุงูุฎุฑูุฌุ')) {
        clearSession();
        window.location.href = "index.html";
      }
    }

    // Load page when authenticated
    window.addEventListener('DOMContentLoaded', function() {
      initializePage();
      
      // Close mobile menu when clicking on a link
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach(link => {
        link.addEventListener('click', function() {
          const navMenu = document.getElementById('navMenu');
          navMenu.classList.remove('active');
        });
      });
    });
  </script>

  <script src="uploadPDF.js"></script>