<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±</title>
  <link rel="stylesheet" href="styleAttendance.css">
  
</head>
<style>

.export-buttons {
  display: flex;
  gap: 10px; 
  margin-top: 10px;
}

.export-buttons button {
  flex: 1; 
  height: 45px;
  font-size: 1rem;
  font-weight: bold;
  border: none;
  border-radius: 5px;
  color: white;
  cursor: pointer;
  transition: 0.3s;
}

.btn-primary {
  background-color: var(--primary);
}

.btn-success {
  background-color: var(--success);
}

.export-buttons button:hover {
  filter: brightness(1.1);
}
</style>


<body>
  <nav class="navbar">
    <div class="logo">
      <img src="church-logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹">
      <button class="menu-toggle" onclick="toggleMobileMenu()">â˜°</button>
    </div>
<div class="nav-right" id="navMenu">
      <a href="index.html" class="nav-link">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="teacherDashboard.html" class="nav-link">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
      <a href="AttendanceData.html" class="nav-link">Ø£Ø®Ø° Ø§Ù„Ø­Ø¶ÙˆØ±</a>
      <a href="profilepage.html" class="nav-link">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
      <a href="javascript:void(0)" onclick="logout()" class="nav-link">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    </div>
  </nav>

  <div class="container">
    <main>
      <h2>Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
      <div class="export-buttons">
        <button class="btn-primary" onclick="printAttendance()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© / ØªØ­Ù…ÙŠÙ„ PDF</button>
        <button class="btn-success" onclick="exportToExcel()">ğŸ“Š ØªØµØ¯ÙŠØ± Excel</button>
      </div>

      <div class="controls">
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ØªØ§Ø±ÙŠØ®" oninput="filterAttendanceHistory()">

        <label for="dateSelect">Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>

        <select id="dateSelect">
          <option value="">-- ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® --</option>
        </select>
        <button onclick="fetchAttendanceByDate()">Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¶ÙˆØ±</button>
      </div>

      <div class="table-container">
        <table id="historyTable">
        <thead>
            <tr>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
              <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            </tr>
          </thead>
          <tbody id="attendanceBody">
            <tr><td colspan="3" class="empty-state">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¶ÙˆØ±</td></tr>
          </tbody>
        </table>
      </div>
    </main>
  </div>


  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDwcSo_bhqO5svMl3kAL8N1c91nvEZ_sac",
      authDomain: "edad-5odam.firebaseapp.com",
      databaseURL: "https://edad-5odam-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "edad-5odam",
      storageBucket: "edad-5odam.appspot.com",
      messagingSenderId: "679576633778",
      appId: "1:679576633778:web:566e6aaef9b72f71a824ab"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function checkAuth() {
      const currentUser = sessionStorage.getItem("currentUser");
      if (!currentUser) {
        alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©");
        window.location.href = "login.html";
        return false;
      }
      return true;
    }

    function toggleMobileMenu() {
      const navMenu = document.getElementById('navMenu');
      navMenu.classList.toggle('active');
    }

    function logout() {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
        sessionStorage.removeItem("currentUser");
        alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­!");
        window.location.href = "login.html";
      }
    }

    async function loadAvailableDates() {
      try {
        const snapshot = await db.ref('attendance').once('value');
        const data = snapshot.val();
        const dateSelect = document.getElementById('dateSelect');
        dateSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® --</option>';

        if (data) {
          const dates = Object.keys(data).sort((a, b) => new Date(b) - new Date(a));
          dates.forEach(date => {
            const option = document.createElement('option');
            option.value = date;
            option.textContent = new Date(date).toLocaleDateString('ar-EG', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
              weekday: 'long'
            });
            dateSelect.appendChild(option);
          });
        } else {
          dateSelect.innerHTML = '<option value="">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØ§Ø±ÙŠØ® Ù…ØªØ§Ø­Ø©</option>';
        }
      } catch (error) {
        console.error("Error loading dates:", error);
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®");
      }
    }

    async function fetchAttendanceByDate() {
      if (!checkAuth()) return;

      const date = document.getElementById('dateSelect').value;
      const tbody = document.getElementById('attendanceBody');
      tbody.innerHTML = '';

      if (!date) {
        tbody.innerHTML = '<tr><td colspan="3" class="empty-state">âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ®</td></tr>';
        return;
      }

      try {
        const snapshot = await db.ref('attendance/' + date).once('value');
        const data = snapshot.val();

        if (!data) {
          tbody.innerHTML = '<tr><td colspan="3">ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</td></tr>';
          return;
        }

        Object.keys(data).forEach(studentId => {
          const record = data[studentId];
          const row = document.createElement('tr');

          const nameCell = document.createElement('td');
          nameCell.textContent = record.studentName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';

          const teamCell = document.createElement('td');
          teamCell.textContent = record.team || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

          const statusCell = document.createElement('td');
          statusCell.textContent = record.status === 'present' ? 'Ø­Ø§Ø¶Ø± âœ…' : 'ØºØ§Ø¦Ø¨ âŒ';
          statusCell.className = record.status === 'present' ? 'status-present' : 'status-absent';

          row.appendChild(nameCell);
          row.appendChild(teamCell);
          row.appendChild(statusCell);

          tbody.appendChild(row);
        });
      } catch (error) {
        console.error('Error fetching data:', error);
        tbody.innerHTML = '<tr><td colspan="3">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
      }
    }

    window.onload = function() {
      checkAuth();
      loadAvailableDates();
    };
    document.querySelector('.menu-toggle').addEventListener('click', function () {
  document.querySelector('.nav-right').classList.toggle('show');
});

function printAttendance() {
    const printContents = document.getElementById("historyTable").outerHTML;
    const printWindow = window.open("", "", "height=600,width=800");
    printWindow.document.write("<html><head><title>Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±</title>");
    printWindow.document.write("<style>");
    printWindow.document.write("table { width: 100%; border-collapse: collapse; direction: rtl; font-family: Arial; }");
    printWindow.document.write("th, td { border: 1px solid black; padding: 10px; text-align: center; }");
    printWindow.document.write("</style>");
    printWindow.document.write("</head><body>");
    printWindow.document.write("<h2>Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±</h2>");
    printWindow.document.write(printContents);
    printWindow.document.write("</body></html>");
    printWindow.document.close();
    printWindow.print();
  }
  function filterAttendanceHistory() {
  const input = document.getElementById("searchInput").value.toLowerCase();
  const rows = document.querySelectorAll("#attendanceBody tr");

  rows.forEach(row => {
    const name = row.cells[0]?.textContent.toLowerCase() || "";
    const team = row.cells[1]?.textContent.toLowerCase() || "";
    const status = row.cells[2]?.textContent.toLowerCase() || "";

    if (name.includes(input) || team.includes(input) || status.includes(input)) {
      row.style.display = "";
    } else {
      row.style.display = "none";
    }
  });
}


  </script>
  <script>
    loadAttendanceHistory();
  </script>

</body>
</html>


