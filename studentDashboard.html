<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="logoCircle1.png">
  <link rel="stylesheet" href="botStyle.css">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ø§Ù„Ø¨ - Ø®Ø¯Ù…ØªÙŠ</title>
  <style>
  body {
  font-family: "Cairo", sans-serif;
  /* background: linear-gradient(to bottom right, #eaf1ff, #dbe5ff); */
  color: #222;
  margin: 0;
  padding: 0;
  direction: rtl;
  min-height: 100vh;
  background-image: url('knesa.jpg'); /* Change path to your image */
  background-size: cover;        /* Make image cover the whole page */
  background-repeat: no-repeat;  /* Prevent repeating */
  /* background-attachment: fixed;  Keeps background fixed when scrolling */
  background-position: center;   /* Center the image */
  font-family: 'Arial', sans-serif;
}
/* Mobile menu toggle button */
.menu-toggle {
  display: none;
  background: none;
  border: none;
  color: white;
  font-size: 1.5rem;
  cursor: pointer;
  padding: 8px;
  border-radius: 4px;
  transition: background-color 0.3s;
}

.menu-toggle:hover {
  background-color: rgba(255, 255, 255, 0.2);
}

/* Mobile responsive styles */
@media (max-width: 768px) {
  .navbar {
    flex-direction: column;
    padding: 10px;
  }

  .nav-left {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .nav-left .church-logo {
    height: 60px;
  }

  .menu-toggle {
    display: block;
  }

  .nav-right {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 0;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .nav-right.active {
    max-height: 300px;
  }

  .nav-link {
    width: 100%;
    text-align: center;
    padding: 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0;
  }

  .nav-link:last-child {
    border-bottom: none;
  }
}

.navbar {
  background-color: #233B6E;
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

.nav-left .church-logo {
  height: 80px;
  border: 3px solid #fff;
  border-radius: 12px;
  padding: 4px;
  background-color: white;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

.nav-right .nav-link {
  color: white;
  text-decoration: none;
  margin-left: 15px;
  font-weight: bold;
  padding: 8px 12px;
  border-radius: 6px;
  transition: 0.3s;
}

.nav-right .nav-link:hover,
.nav-right .nav-link:focus,
.nav-right .nav-link:active {
  background-color: #1a2d59;
  color: #fff;
  text-decoration: none;
}

header {
  background-color:  #ffffff52;
  text-align: center;
  padding: 40px 20px 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  border-bottom: 3px solid #233B6E22;
  border-radius: 0 0 25px 25px;
  font-weight:700;
}

.logo {
  width: 90px;
  height: auto;
  margin-bottom: 10px;
  transition: transform 0.3s;
}

.logo:hover {
  transform: scale(1.1);
}

h1 {
  margin: 10px 0 5px;
  font-size: 2.5em;
  color: #233B6E;
}

.tagline {
  font-size: 1.1em;
  color: #555;
}

main {
  flex: 1;
  padding: 30px 20px;
  max-width: 800px;
  margin: 0 auto;
  font-weight:600;
}

section {
  margin-bottom: 40px;
  background-color: #ffffff66;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.08);
}

h2 {
  color: #233B6E;
  margin-bottom: 10px;
}

p {
  line-height: 1.8;
  font-size: 1.05em;
}

.btn {
  display: inline-block;
  background: linear-gradient(to right, #233B6E, #314d9f);
  color: white;
  padding: 12px 24px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: bold;
  margin: 10px;
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
  transition: all 0.3s ease-in-out;
}

.btn:hover {
  background: #1a2d59;
  transform: scale(1.05);
}

footer {
  background-color: #233B6E;
  color: white;
  text-align: center;
  padding: 15px;
  font-size: 0.9em;
  margin-top: auto;
  box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
}

.container {
   background-color: white;
  padding: 30px;
  max-width: 650px;
  width: 80%; 
  margin: 60px auto;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.container h2 {
  text-align: center;
  color: #233B6E;
  margin-bottom: 20px;
}

input[type="text"],
input[type="email"],
input[type="password"],
input[type="tel"] {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 1.05em;
}

label {
  font-weight: bold;
  color: #233B6E;
}

.back-icon {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 1.2em;
  color: #233B6E;
  text-decoration: none;
}

.role-options {
  display: flex;
  gap: 20px;
  margin-top: -10px;
  font-weight: normal;
}
  body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: inherit;
    
    z-index: -1;
  }
    .dashboard-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    .welcome-section {
      background: linear-gradient(135deg, #233B6E, #314d9f);
      color: white;
      padding: 40px 30px;
      border-radius: 20px;
      text-align: center;
      margin-bottom: 40px;
      box-shadow: 0 8px 25px rgba(56, 142, 60, 0.3);
    }

    .welcome-section h1 {
      font-size: 2.5em;
      margin-bottom: 15px;
      color: white;
    }

    .welcome-section p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .dashboard-card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      text-align: center;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .dashboard-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(135deg, #233B6E, #314d9f);
    }

    .dashboard-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.15);
      border-color: #233B6E;
    }

    .card-icon {
      font-size: 3em;
      margin-bottom: 20px;
      color: #233B6E;
    }

    .card-title {
      font-size: 1.4em;
      color: #233B6E;
      margin-bottom: 15px;
      font-weight: bold;
    }

    .card-description {
      color: #666;
      margin-bottom: 25px;
      line-height: 1.6;
    }

    .card-btn {
      background: linear-gradient(45deg, #233B6E, #314d9f);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }

    .card-btn:hover {
      background: linear-gradient(45deg, #1a2d59, #233B6E);
      transform: scale(1.02);
    }

    .notifications-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      margin-bottom: 40px;
    }

    .notifications-section h3 {
      color: #233B6E;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #latestNotifications {
      transition: opacity 0.3s ease;
    }

    .notification-item {
      background: #f8fff8;
      border: 1px solid #e8f5e8;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 4px solid #233B6E;
      transition: all 0.3s ease;
    }

    .notification-item:hover {
      transform: translateX(-3px);
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    .notification-title {
      font-weight: bold;
      color: #233B6E;
      margin-bottom: 5px;
    }

    .notification-message {
      color: #666;
      margin-bottom: 8px;
    }

    .notification-time {
      font-size: 0.9em;
      color: #999;
    }

    .quick-links {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 40px;
    }

    .quick-link {
      background: linear-gradient(135deg,rgb(255, 255, 255),rgb(252, 252, 252));
      color: #233B6E;
      padding: 20px;
      border-radius: 12px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      text-align: center;
      border: 2px solid transparent;
    }

    .quick-link:hover {
      border-color: #233B6E;
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(56, 142, 60, 0.2);
    }

    .study-progress {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      text-align: center;
    }

    .study-progress h3 {
      color: #233B6E;
      margin-bottom: 20px;
    }

    .progress-bar {
      background: #e8f5e8;
      border-radius: 20px;
      height: 20px;
      margin: 20px 0;
      overflow: hidden;
    }

    .progress-fill {
      background: linear-gradient(45deg, #1a2d59, #233B6E);
      height: 100%;
      width: 75%;
      border-radius: 20px;
      transition: width 0.3s ease;
    }

    .progress-text {
      color: #666;
      margin-top: 10px;
    }

    .empty-notifications {
      text-align: center;
      padding: 40px;
      color: #999;
    }

    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .quick-links {
        grid-template-columns: 1fr;
      }
      
      .welcome-section h1 {
        font-size: 2em;
      }
      
      .dashboard-card {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="nav-left">
      <img src="church-logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ÙƒÙ†ÙŠØ³Ø©" class="church-logo">
      <button class="menu-toggle" onclick="toggleMobileMenu()">â˜°</button>
    </div>
    <div class="nav-right" id="navMenu">
      <a href="index.html" class="nav-link">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="profilepage.html" class="nav-link">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
      <a href="javascript:void(0)" class="nav-link" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    </div>
  </nav>

  <div class="dashboard-container">
    <div class="welcome-section">
      <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ   <span id="username">Ø§Ù„Ø·Ø§Ù„Ø¨</span></h1>
      <p>Ù…Ù†ØµØªÙƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù†Ù…Ùˆ Ø§Ù„Ø±ÙˆØ­ÙŠ ÙˆØ§Ù„Ø¹Ù„Ù…ÙŠ</p>
    </div>

    <div class="notifications-section">
      <h3>ğŸ”” Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
      <div id="latestNotifications">
        <div class="empty-notifications">
          <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
        </div>
      </div>
      <div style="text-align: center; margin-top: 20px;">
        <a href="alerts-list.html" class="card-btn" style="width: auto; padding: 10px 20px;">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</a>
      </div>
    </div>

    <div class="quick-links">
      <a href="alerts-list.html" class="quick-link">
        ğŸ””<br>Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
      </a>
      <a href="listPDF-Stu.html" class="quick-link">
        ğŸ“š<br>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©
      </a>
      <a href="listPhotos-stu.html" class="quick-link">
        ğŸ–¼ï¸<br>Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±
      </a>
      <a href="student-exam.html" class="quick-link">
        ğŸ“<br>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
      </a>
      <a href="uploadResearch.html" class="quick-link">
        ğŸ“‹<br>ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¨Ø­ÙˆØ«
      </a>
      <a href="index.html" class="quick-link">
        ğŸ <br>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      </a>
    </div>

    <div class="dashboard-grid">
      <div class="dashboard-card">
        <div class="card-icon">ğŸ””</div>
        <div class="card-title">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</div>
        <div class="card-description">ØªØ§Ø¨Ø¹ Ø¢Ø®Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ù…Ù† Ø®Ø¯Ø§Ù…Ùƒ</div>
        <a href="alerts-list.html" class="card-btn">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</a>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">ğŸ“š</div>
        <div class="card-title">Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</div>
        <div class="card-description">ØªØµÙØ­ ÙˆØ­Ù…Ù‘Ù„ Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©</div>
        <a href="listPDF-Stu.html" class="card-btn">ØªØµÙØ­ Ø§Ù„Ù…ØµØ§Ø¯Ø±</a>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">ğŸ–¼ï¸</div>
        <div class="card-title">Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</div>
        <div class="card-description">Ø´Ø§Ù‡Ø¯ ØµÙˆØ± Ø§Ù„Ø£Ù†Ø´Ø·Ø© ÙˆØ§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</div>
        <a href="listPhotos-stu.html" class="card-btn">ØªØµÙØ­ Ø§Ù„ØµÙˆØ±</a>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">ğŸ“</div>
        <div class="card-title">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</div>
        <div class="card-description">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ÙˆØªØ§Ø¨Ø¹ Ù†ØªØ§Ø¦Ø¬Ùƒ</div>
        <a href="student-exam.html" class="card-btn">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</a>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">ğŸ“‹</div>
        <div class="card-title">ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¨Ø­ÙˆØ«</div>
        <div class="card-description">Ø§Ø±ÙØ¹ ÙˆØ³Ù„Ù… Ø§Ù„Ø¨Ø­ÙˆØ« ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù†Ùƒ</div>
        <a href="uploadResearch.html" class="card-btn">ØªØ³Ù„ÙŠÙ… Ø¨Ø­Ø«</a>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">ğŸ‘¤</div>
        <div class="card-title">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</div>
        <div class="card-description">Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</div>
        <a href="profilepage.html" class="card-btn">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ù</a>
      </div>
    </div>

    <div class="study-progress">
      <h3>ğŸ“ˆ ØªÙ‚Ø¯Ù…Ùƒ ÙÙŠ Ø§Ù„ØªØ¹Ù„Ù…</h3>
      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>
      <div class="progress-text">
        75% Ù…Ù† Ø§Ù„ØªØ±Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…ÙƒØªÙ…Ù„
      </div>
      <p style="color: #666; margin-top: 15px;">
        Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©! Ø£Ø¯Ø§Ø¤Ùƒ Ù…Ù…ØªØ§Ø² Ù‡Ø°Ø§ Ø§Ù„ØªØ±Ù…
      </p>
    </div>
  </div>

  <!-- Chat Button -->
  <div id="chat-button" onclick="toggleChat()">
    ğŸ¤–
  </div>

  <!-- Chat Container -->
  <div id="chat-container">
    <div id="chat-header">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</div>
    <div id="chat-body"></div>
    <div id="chat-input">
      <input type="text" style="font-size: 20px;" id="user-input" placeholder="Ø£Ø³Ø§Ù„Ù†ÙŠ Ø§ÙŠ Ø³Ø¤Ø§Ù„..." onkeydown="if(event.key === 'Enter') sendMessage()">
      <button onclick="sendMessage()">ğŸ“¤</button>
    </div>
  </div>

  <footer>
    <p>Â© ÙƒÙ†ÙŠØ³Ø© Ø§Ù„Ø³ÙŠØ¯Ø© Ø§Ù„Ø¹Ø°Ø±Ø§Ø¡ - Ø¹Ø²Ø¨Ø© Ø§Ù„Ù†Ø®Ù„ | ØªØ·Ø¨ÙŠÙ‚ Ø®Ø¯Ù…ØªÙŠ 2025</p>
  </footer>

  <script src="botScript.js"></script>
  <!-- Place this at the bottom of your studentDashboard.html file before </body> -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
  // Firebase configuration (replace only if different)
  const firebaseConfig = {
    apiKey: "AIzaSyDwcSo_bhqO5svMl3kAL8N1c91nvEZ_sac",
    authDomain: "edad-5odam.firebaseapp.com",
    databaseURL: "https://edad-5odam-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "edad-5odam",
    storageBucket: "edad-5odam.appspot.com",
    messagingSenderId: "679576633778",
    appId: "1:679576633778:web:566e6aaef9b72f71a824ab",
    measurementId: "G-7WB1WPDLRH"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // Cache management system
  class DataCache {
    constructor() {
      this.cache = new Map();
      this.listeners = new Map();
      this.lastUpdated = new Map();
      this.cacheExpiry = 5 * 60 * 1000; // 5 minutes cache expiry
    }

    // Check if cached data is still valid
    isCacheValid(path) {
      const lastUpdate = this.lastUpdated.get(path);
      if (!lastUpdate) return false;
      return (Date.now() - lastUpdate) < this.cacheExpiry;
    }

    // Get data from cache or Firebase with real-time listener
    async getData(path, callback) {
      // If we have valid cached data, use it immediately
      if (this.isCacheValid(path) && this.cache.has(path)) {
        console.log(`[Student Dashboard] Using cached data for ${path}`);
        if (callback) callback(this.cache.get(path));
        return this.cache.get(path);
      }

      // Set up real-time listener if not already exists
      if (!this.listeners.has(path)) {
        console.log(`[Student Dashboard] Setting up real-time listener for ${path}`);
        const listener = database.ref(path).on('value', (snapshot) => {
          const data = snapshot.val() || {};
          this.cache.set(path, data);
          this.lastUpdated.set(path, Date.now());
          console.log(`[Student Dashboard] Data updated for ${path}:`, Object.keys(data).length, 'items');
          if (callback) callback(data);
        });
        this.listeners.set(path, listener);
      }

      // Return cached data if available, otherwise return empty object
      return this.cache.get(path) || {};
    }

    // Clean up listeners when not needed
    cleanup() {
      this.listeners.forEach((listener, path) => {
        database.ref(path).off('value', listener);
      });
      this.listeners.clear();
      this.cache.clear();
      this.lastUpdated.clear();
    }
  }

  // Initialize cache instance
  const dataCache = new DataCache();

  // Debounce function to prevent rapid successive updates
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  // ğŸ” Get current user
  const currentEmail = sessionStorage.getItem("currentUser");
  if (!currentEmail) {
    window.location.href = "login.html";
  }

  const emailKey = currentEmail.replace(/\./g, '_');

  // Enhanced user authentication with caching
  async function checkAuthentication() {
    console.log("[Student Dashboard] Checking authentication for:", currentEmail);
    
    if (!currentEmail) {
      window.location.href = "login.html";
      return false;
    }

    // Wait for user data to be loaded from cache/Firebase
    const userData = await new Promise((resolve) => {
      dataCache.getData(`users/${emailKey}`, (data) => {
        console.log("[Student Dashboard] User data loaded:", data);
        resolve(data);
      });
    });
    
    if (!userData || Object.keys(userData).length === 0) {
      console.log("[Student Dashboard] No user data found, redirecting to login");
      window.location.href = "login.html";
      return false;
    }

    const usernameElement = document.getElementById("username");
    if (usernameElement && userData.username) {
      const displayName = userData.username.split(" ").slice(0, 2).join(" ");
      console.log("[Student Dashboard] Setting username to:", displayName);
      usernameElement.textContent = displayName;
    }

    return true;
  }

  // ğŸ”” Load latest notifications
  document.addEventListener('DOMContentLoaded', async function() {
    console.log("[Student Dashboard] Initializing dashboard...");
    
    // Check authentication first
    const isAuthenticated = await checkAuthentication();
    if (!isAuthenticated) {
      return; // Exit if not authenticated
    }

    console.log("[Student Dashboard] User authenticated, setting up real-time updates...");
    
    // Setup real-time notifications listener
    loadLatestNotifications();
    
    // Set up real-time listener for alerts that will auto-update notifications
    dataCache.getData('alerts', () => {
      console.log("[Student Dashboard] Alerts updated, refreshing notifications...");
      debouncedLoadNotifications();
    });

    console.log("[Student Dashboard] Dashboard setup complete with smart caching");
  });

  // ğŸ”” Enhanced notifications with smart caching
  function loadLatestNotifications() {
    console.log("[Student Dashboard] Loading notifications from cache...");
    
    // Use cached data with real-time listener
    dataCache.getData('alerts', (alertsData) => {
      const notificationsContainer = document.getElementById('latestNotifications');
      
      if (!alertsData || Object.keys(alertsData).length === 0) {
        notificationsContainer.innerHTML = `
          <div class="empty-notifications">
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
          </div>
        `;
        return;
      }

      // Convert to array and sort by timestamp or order
      const alerts = Object.values(alertsData);
      const latestAlerts = alerts.slice(-3).reverse(); // Get last 3 alerts
      
      console.log("[Student Dashboard] Displaying", latestAlerts.length, "notifications");
      
      notificationsContainer.innerHTML = latestAlerts.map(alert => `
        <div class="notification-item">
          <div class="notification-title">${alert.title || 'ØªÙ†Ø¨ÙŠÙ‡'}</div>
          <div class="notification-message">${alert.message || ''}</div>
          <div class="notification-time">${alert.time || alert.timestamp || 'Ù…Ù†Ø° Ù‚Ù„ÙŠÙ„'}</div>
        </div>
      `).join('');

      // Add subtle animation to show data refresh
      notificationsContainer.style.opacity = '0.7';
      setTimeout(() => {
        notificationsContainer.style.opacity = '1';
      }, 100);
    });
  }

  // Debounced version to prevent rapid updates
  const debouncedLoadNotifications = debounce(loadLatestNotifications, 200);

  // Mobile menu toggle function
  function toggleMobileMenu() {
    const navMenu = document.getElementById('navMenu');
    navMenu.classList.toggle('active');
  }

  // ğŸ”“ Logout
  function logout() {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
        sessionStorage.removeItem("currentUser");
        window.location.href = "index.html";
      }
    }

  // Close mobile menu when clicking on a link
  document.addEventListener('DOMContentLoaded', function() {
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
      link.addEventListener('click', function() {
        const navMenu = document.getElementById('navMenu');
        navMenu.classList.remove('active');
      });
    });
  });

  // Clean up listeners when page is unloaded
  window.addEventListener('beforeunload', function() {
    console.log('[Student Dashboard] Cleaning up Firebase listeners...');
    dataCache.cleanup();
  });

  // Performance monitoring
  window.addEventListener('load', function() {
    console.log('[Student Dashboard] Page loaded, cache system active');
  });

</script>

</body>
</html>