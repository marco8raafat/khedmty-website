<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="logoCircle1.png">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ø§Ù„Ø¨ - Ø®Ø¯Ù…ØªÙŠ</title>
  <style>
  body {
  font-family: "Cairo", sans-serif;
  /* background: linear-gradient(to bottom right, #eaf1ff, #dbe5ff); */
  color: #222;
  margin: 0;
  padding: 0;
  direction: rtl;
  min-height: 100vh;
  background-image: url('knesa.jpg'); /* Change path to your image */
  background-size: cover;        /* Make image cover the whole page */
  background-repeat: no-repeat;  /* Prevent repeating */
  /* background-attachment: fixed;  Keeps background fixed when scrolling */
  background-position: center;   /* Center the image */
  font-family: 'Arial', sans-serif;
}
/* Mobile menu toggle button */
.menu-toggle {
  display: none;
  background: none;
  border: none;
  color: white;
  font-size: 1.5rem;
  cursor: pointer;
  padding: 8px;
  border-radius: 4px;
  transition: background-color 0.3s;
}

.menu-toggle:hover {
  background-color: rgba(255, 255, 255, 0.2);
}

/* Mobile responsive styles */
@media (max-width: 768px) {
  .navbar {
    flex-direction: column;
    padding: 10px;
  }

  .nav-left {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .nav-left .church-logo {
    height: 60px;
  }

  .menu-toggle {
    display: block;
  }

  .nav-right {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 0;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .nav-right.active {
    max-height: 300px;
  }

  .nav-link {
    width: 100%;
    text-align: center;
    padding: 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0;
  }

  .nav-link:last-child {
    border-bottom: none;
  }
}

.navbar {
  background-color: #233B6E;
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

.nav-left .church-logo {
  height: 60px;
  border: 3px solid #fff;
  border-radius: 12px;
  padding: 4px;
  background-color: white;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

.nav-right .nav-link {
  color: white;
  text-decoration: none;
  margin-left: 15px;
  font-weight: bold;
  padding: 8px 12px;
  border-radius: 6px;
  transition: 0.3s;
}

.nav-right .nav-link:hover,
.nav-right .nav-link:focus,
.nav-right .nav-link:active {
  background-color: #1a2d59;
  color: #fff;
  text-decoration: none;
}

header {
  background-color:  #ffffff52;
  text-align: center;
  padding: 40px 20px 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  border-bottom: 3px solid #233B6E22;
  border-radius: 0 0 25px 25px;
  font-weight:700;
}

.logo {
  width: 90px;
  height: auto;
  margin-bottom: 10px;
  transition: transform 0.3s;
}

.logo:hover {
  transform: scale(1.1);
}

h1 {
  margin: 10px 0 5px;
  font-size: 2.5em;
  color: #233B6E;
}

.tagline {
  font-size: 1.1em;
  color: #555;
}

main {
  flex: 1;
  padding: 30px 20px;
  max-width: 800px;
  margin: 0 auto;
  font-weight:600;
}

section {
  margin-bottom: 40px;
  background-color: #ffffff66;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.08);
}

h2 {
  color: #233B6E;
  margin-bottom: 10px;
}

p {
  line-height: 1.8;
  font-size: 1.05em;
}

.btn {
  display: inline-block;
  background: linear-gradient(to right, #233B6E, #314d9f);
  color: white;
  padding: 12px 24px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: bold;
  margin: 10px;
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
  transition: all 0.3s ease-in-out;
}

.btn:hover {
  background: #1a2d59;
  transform: scale(1.05);
}

footer {
  background-color: #233B6E;
  color: white;
  text-align: center;
  padding: 15px;
  font-size: 0.9em;
  margin-top: auto;
  box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
}

.container {
   background-color: white;
  padding: 30px;
  max-width: 650px;
  width: 80%; 
  margin: 60px auto;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.container h2 {
  text-align: center;
  color: #233B6E;
  margin-bottom: 20px;
}

input[type="text"],
input[type="email"],
input[type="password"],
input[type="tel"] {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 1.05em;
}

label {
  font-weight: bold;
  color: #233B6E;
}

.back-icon {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 1.2em;
  color: #233B6E;
  text-decoration: none;
}

.role-options {
  display: flex;
  gap: 20px;
  margin-top: -10px;
  font-weight: normal;
}
  body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: inherit;
    
    z-index: -1;
  }
    .dashboard-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    .welcome-section {
      background: linear-gradient(135deg, #233B6E, #314d9f);
      color: white;
      padding: 40px 30px;
      border-radius: 20px;
      text-align: center;
      margin-bottom: 40px;
      box-shadow: 0 8px 25px rgba(9, 9, 9, 0.3);
    }

    .welcome-section h1 {
      font-size: 2.5em;
      margin-bottom: 15px;
      color: white;
    }

    .welcome-section p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .dashboard-card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      text-align: center;
      box-shadow: 0 5px 20px rgba(0,0,0,0.4);
      transition: all 0.3s ease;
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .dashboard-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(135deg, #233B6E, #314d9f);
    }

    .dashboard-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.15);
      border-color: #233B6E;
    }

    .card-icon {
      font-size: 3em;
      margin-bottom: 20px;
      color: #233B6E;
    }

    .card-title {
      font-size: 1.4em;
      color: #233B6E;
      margin-bottom: 15px;
      font-weight: bold;
    }

    .card-description {
      color: #666;
      margin-bottom: 25px;
      line-height: 1.6;
    }

    .card-btn {
      background: linear-gradient(45deg, #233B6E, #314d9f);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }

    .card-btn:hover {
      background: linear-gradient(45deg, #1a2d59, #233B6E);
      transform: scale(1.02);
    }

    .notifications-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.4);
      margin-bottom: 40px;
    }

    .notifications-section h3 {
      color: #233B6E;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #latestNotifications {
      transition: opacity 0.3s ease;
    }

    .notification-item {
      background: #f8fff8;
      border: 1px solid #e8f5e8;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 4px solid #233B6E;
      transition: all 0.3s ease;
    }

    .notification-item:hover {
      transform: translateX(-3px);
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    .notification-title {
      font-weight: bold;
      color: #233B6E;
      margin-bottom: 5px;
    }

    .notification-message {
      color: #666;
      margin-bottom: 8px;
    }

    .notification-time {
      font-size: 0.9em;
      color: #999;
    }

    .quick-links {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 15px;
      margin-bottom: 40px;
    }

    .quick-link {
      background: linear-gradient(135deg,rgb(255, 255, 255),rgb(252, 252, 252));
      color: #233B6E;
      padding: 20px;
      border-radius: 12px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      text-align: center;
      border: 2px solid transparent;
      box-shadow: 0 5px 20px rgba(0,0,0,0.4);
    }

    .quick-link:hover {
      border-color: #233B6E;
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(56, 142, 60, 0.2);
    }

    .study-progress {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      text-align: center;
    }

    .study-progress h3 {
      color: #233B6E;
      margin-bottom: 20px;
      font-size: 1.3em;
    }

    .progress-bar {
      background: #e8f5e8;
      border-radius: 20px;
      height: 25px;
      margin: 20px 0;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    .progress-fill {
      background: linear-gradient(45deg, #1a2d59, #233B6E, #314d9f);
      height: 100%;
      width: 0%;
      border-radius: 20px;
      transition: width 0.8s ease-in-out;
      position: relative;
      overflow: hidden;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .progress-text {
      color: #233B6E;
      margin-top: 10px;
      font-weight: bold;
      font-size: 1.1em;
    }

    .progress-details {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
      border-left: 4px solid #233B6E;
    }

    .loading-progress .progress-fill {
      background: linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%);
      animation: loading 1.5s infinite;
    }

    @keyframes loading {
      0% { background-position: -200px 0; }
      100% { background-position: 200px 0; }
    }

    .refresh-btn {
      background: none;
      border: none;
      color: #233B6E;
      margin-left: 10px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .refresh-btn:hover {
      color: white;
      transform: rotate(180deg);
    }

    .refresh-btn:active {
      transform: rotate(360deg);
    }

    .empty-notifications {
      text-align: center;
      padding: 40px;
      color: #999;
    }

    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .quick-links {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }
      
      .welcome-section h1 {
        font-size: 2em;
      }
      
      .dashboard-card {
        padding: 20px;
      }
    }
.cross-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
  overflow: hidden;
}
.glowing-cross {
    font-size: 50px;
    color: white;
    opacity: 0.6;
    filter: drop-shadow(0 0 8px rgba(173, 216, 230, 0.4));
    transition: all 0.3s ease;
    position: absolute;
    top: 40px;
    left: 40px;
  }

 
.cross {
  position: absolute;
  width: 30px;
  height: 30px;
  animation: float 12s linear infinite;
  opacity: 0.7;
  filter: drop-shadow(0 0 6px rgba(255, 255, 255, 0.6));
}

.cross svg {
  width: 100%;
  height: 100%;
  fill: rgba(255, 255, 255, 0.265);
}

@keyframes float {
  0% {
    transform: translateY(100vh) scale(1);
    opacity: 0;
  }
  20% {
    opacity: 1;
  }
  100% {
    transform: translateY(-20vh) scale(1.3);
    opacity: 0;
  }
}   

  /* Loading overlay */
  .loading-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 9999;
  }
  .loading-overlay.hidden { display: none !important; }
  .loading-spinner {
    width: 56px;
    height: 56px;
    border: 6px solid rgba(255, 255, 255, 0.3);
    border-top-color: #233B6E;
    border-radius: 50%;
    animation: dash-spin 0.9s linear infinite;
  }
  .loading-text { margin-top: 12px; color: #fff; font-weight: 600; letter-spacing: 0.5px; }
  @keyframes dash-spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
<div id="loadingOverlay" class="loading-overlay hidden" role="status" aria-live="polite" aria-busy="true">
  <div class="loading-spinner" aria-hidden="true"></div>
  <div class="loading-text">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</div>
<div class="cross-background"></div>
  <nav class="navbar">
    <div class="nav-left">
      <img src="church-logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ÙƒÙ†ÙŠØ³Ø©" class="church-logo">
      <button class="menu-toggle" onclick="toggleMobileMenu()">â˜°</button>
    </div>
    <div class="nav-right" id="navMenu">
      <a href="index.html" class="nav-link">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="profilepage.html" class="nav-link">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
      <a href="javascript:void(0)" class="nav-link" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    </div>
  </nav>

  <div class="dashboard-container">
    <div class="welcome-section">
      <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ   <span id="username">Ø§Ù„Ø·Ø§Ù„Ø¨</span></h1>
      <p>Ù…Ù†ØµØªÙƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù†Ù…Ùˆ Ø§Ù„Ø±ÙˆØ­ÙŠ ÙˆØ§Ù„Ø¹Ù„Ù…ÙŠ</p>
    </div>

    <div class="notifications-section">
      <h3>ğŸ”” Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
      <div id="latestNotifications">
        <div class="empty-notifications">
          <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
        </div>
      </div>
      <div style="text-align: center; margin-top: 20px;">
        <a href="alerts-list.html" class="card-btn" style="width: auto; padding: 10px 20px;">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</a>
      </div>
    </div>

    <div class="quick-links">
      <a href="index.html" class="quick-link">
        ğŸ <br>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      </a>
      <a href="alerts-list.html" class="quick-link">
        ğŸ””<br>Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
      </a>
      <a href="listPDF-Stu.html" class="quick-link">
        ğŸ“š<br>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©
      </a>
      <a href="listPhotos-stu.html" class="quick-link">
        ğŸ–¼ï¸<br>Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±
      </a>
      <a href="student-exam.html" class="quick-link">
        ğŸ“<br>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
      </a>
      <a href="uploadResearch.html" class="quick-link">
        ğŸ“‹<br>ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¨Ø­ÙˆØ«
      </a>
      <a href="Grades.html" class="quick-link">
        ğŸ“Š<br>Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
      </a>
      <a href="studentRank.html" class="quick-link">
        ğŸ†<br>Ø£ÙØ¶Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨
      </a>
    </div>

    <div class="dashboard-grid">
      <div class="dashboard-card">
        <div class="card-icon">ğŸ””</div>
        <div class="card-title">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</div>
        <div class="card-description">ØªØ§Ø¨Ø¹ Ø¢Ø®Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ù…Ù† Ø®Ø¯Ø§Ù…Ùƒ</div>
        <a href="alerts-list.html" class="card-btn">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</a>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">ğŸ“š</div>
        <div class="card-title">Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</div>
        <div class="card-description">ØªØµÙØ­ ÙˆØ­Ù…Ù‘Ù„ Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©</div>
        <a href="listPDF-Stu.html" class="card-btn">ØªØµÙØ­ Ø§Ù„Ù…ØµØ§Ø¯Ø±</a>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">ğŸ–¼ï¸</div>
        <div class="card-title">Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</div>
        <div class="card-description">Ø´Ø§Ù‡Ø¯ ØµÙˆØ± Ø§Ù„Ø£Ù†Ø´Ø·Ø© ÙˆØ§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</div>
        <a href="listPhotos-stu.html" class="card-btn">ØªØµÙØ­ Ø§Ù„ØµÙˆØ±</a>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">ğŸ“</div>
        <div class="card-title">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</div>
        <div class="card-description">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ÙˆØªØ§Ø¨Ø¹ Ù†ØªØ§Ø¦Ø¬Ùƒ</div>
        <a href="student-exam.html" class="card-btn">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</a>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">ğŸ“‹</div>
        <div class="card-title">ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¨Ø­ÙˆØ«</div>
        <div class="card-description">Ø§Ø±ÙØ¹ ÙˆØ³Ù„Ù… Ø§Ù„Ø¨Ø­ÙˆØ« ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù†Ùƒ</div>
        <a href="uploadResearch.html" class="card-btn">ØªØ³Ù„ÙŠÙ… Ø¨Ø­Ø«</a>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">ğŸ§‘â€ğŸ“</div>
        <div class="card-title">Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬</div>
        <div class="card-description">Ø§Ø·Ù„Ø¹ Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø§ØªÙƒ ÙˆÙ†ØªØ§Ø¦Ø¬Ùƒ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯</div>
        <a href="Grades.html" class="card-btn">Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</a>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">ğŸ‘¤</div>
        <div class="card-title">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</div>
        <div class="card-description">Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</div>
        <a href="profilepage.html" class="card-btn">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ù</a>
      </div>

      <div class="dashboard-card">
        <div class="card-icon">ğŸ†</div>
        <div class="card-title">Ø£ÙØ¶Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
        <div class="card-description">Ø§Ø·Ù„Ø¹ Ø¹Ù„Ù‰ ØªØ±ØªÙŠØ¨ Ø£ÙØ¶Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</div>
        <a href="studentRank.html" class="card-btn">Ø¹Ø±Ø¶ Ø§Ù„ØªØ±ØªÙŠØ¨</a>
      </div>
      
      <div class="dashboard-card">
        <div class="card-icon">ğŸ </div>
        <div class="card-title">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div class="card-description">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚</div>
        <a href="index.html" class="card-btn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø©</a>
      </div>
    </div>

    <div class="study-progress">
      <h3>ğŸ“ˆ ØªÙ‚Ø¯Ù…Ùƒ ÙÙŠ Ø§Ù„ØªØ¹Ù„Ù… 
        <button onclick="updateProgressDisplay()" class="refresh-btn" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù…">ğŸ”„</button>
      </h3>
      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>
      <div class="progress-text">
        Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù…...
      </div>
      <p style="color: #666; margin-top: 15px;">
        ÙŠØªÙ… Ø­Ø³Ø§Ø¨ ØªÙ‚Ø¯Ù…Ùƒ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙÙ‚Ø·
      </p>
    </div>
  </div>


  <footer>
    <p>Â© ÙƒÙ†ÙŠØ³Ø© Ø§Ù„Ø³ÙŠØ¯Ø© Ø§Ù„Ø¹Ø°Ø±Ø§Ø¡ - Ø¹Ø²Ø¨Ø© Ø§Ù„Ù†Ø®Ù„ | ØªØ·Ø¨ÙŠÙ‚ Ø®Ø¯Ù…ØªÙŠ 2025</p>
  </footer>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="sessionUtils.js"></script>
<script>
  // Firebase configuration 
  const firebaseConfig = {
    apiKey: "AIzaSyDwcSo_bhqO5svMl3kAL8N1c91nvEZ_sac",
    authDomain: "edad-5odam.firebaseapp.com",
    databaseURL: "https://edad-5odam-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "edad-5odam",
    storageBucket: "edad-5odam.appspot.com",
    messagingSenderId: "679576633778",
    appId: "1:679576633778:web:566e6aaef9b72f71a824ab",
    measurementId: "G-7WB1WPDLRH"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // Simple cache for temporary data storage (no real-time listeners)
  class SimpleCache {
    constructor() {
      this.cache = new Map();
      this.cacheExpiry = 30 * 60 * 1000; // 30 minutes expiry
    }

    set(key, value) {
      this.cache.set(key, {
        data: value,
        timestamp: Date.now()
      });
    }

    get(key) {
      const cached = this.cache.get(key);
      if (!cached) return null;
      
      // Check if cache is still valid
      if (Date.now() - cached.timestamp > this.cacheExpiry) {
        this.cache.delete(key);
        return null;
      }
      
      return cached.data;
    }

    clear() {
      this.cache.clear();
    }
  }

  // Initialize simple cache instance
  const simpleCache = new SimpleCache();

  // Debounce function to prevent rapid successive updates
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  // ğŸ” Get current user with secure session verification
  const currentEmail = requireAuthentication();


  const emailKey = currentEmail.replace(/\./g, '_');

  // User authentication with one-time query
  async function checkAuthentication() {
    console.log("[Student Dashboard] Checking authentication for:", currentEmail);
    
    if (!currentEmail) {
      window.location.href = "login.html";
      return false;
    }

    try {
      // One-time query instead of real-time listener
      const snapshot = await database.ref(`users/${emailKey}`).once('value');
      const userData = snapshot.val();
      
      if (!userData) {
        console.log("[Student Dashboard] No user data found, redirecting to login");
        window.location.href = "login.html";
        return false;
      }

      const usernameElement = document.getElementById("username");
      if (usernameElement && userData.username) {
        const displayName = userData.username.split(" ").slice(0, 2).join(" ");
        console.log("[Student Dashboard] Setting username to:", displayName);
        usernameElement.textContent = displayName;
      }

      return true;
    } catch (error) {
      console.error("[Student Dashboard] Error checking authentication:", error);
      window.location.href = "login.html";
      return false;
    }
  }

  // Initialize dashboard with one-time queries and polling
  document.addEventListener('DOMContentLoaded', async function() {
    const overlay = document.getElementById('loadingOverlay');
    try {
      if (overlay) overlay.classList.remove('hidden');

      console.log("[Student Dashboard] Initializing dashboard with optimized queries...");
      
      // Check authentication first
      const isAuthenticated = await checkAuthentication();
      if (!isAuthenticated) {
        return; // Exit if not authenticated (redirect handled elsewhere)
      }

      console.log("[Student Dashboard] User authenticated, loading initial data...");
      
      // Load initial data with one-time queries
      await loadLatestNotifications();
      await updateProgressDisplay();

      // Setup periodic polling instead of real-time listeners (every 60 seconds)
      setInterval(async () => {
        console.log("[Student Dashboard] Periodic data refresh...");
        
        // Clear cache to force fresh data
        simpleCache.clear();
        
        // Refresh notifications and progress
        await loadLatestNotifications();
        await updateProgressDisplay();
      }, 60 * 1000); // Poll every 60 seconds

      console.log("[Student Dashboard] Dashboard setup complete with optimized one-time queries");
    } catch (e) {
      console.error("[Student Dashboard] Error during initialization:", e);
    } finally {
      if (overlay) overlay.classList.add('hidden');
    }
  });

  // ğŸ”” Load latest notifications with one-time query
  async function loadLatestNotifications() {
    console.log("[Student Dashboard] Loading latest notifications...");
    
    try {
      // One-time query - only fetch last 3 alerts
      const snapshot = await database.ref('alerts').limitToLast(3).once('value');
      const alertsData = snapshot.val();
      
      const notificationsContainer = document.getElementById('latestNotifications');
      
      if (!alertsData || Object.keys(alertsData).length === 0) {
        notificationsContainer.innerHTML = `
          <div class="empty-notifications">
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
          </div>
        `;
        return;
      }

      // Convert to array and reverse to show newest first
      const alerts = Object.values(alertsData).reverse();
      
      console.log("[Student Dashboard] Displaying", alerts.length, "notifications");
      
      notificationsContainer.innerHTML = alerts.map(alert => `
        <div class="notification-item">
          <div class="notification-title">${alert.title || 'ØªÙ†Ø¨ÙŠÙ‡'}</div>
          <div class="notification-message">${alert.message || ''}</div>
          <div class="notification-time">${alert.time || alert.timestamp || 'Ù…Ù†Ø° Ù‚Ù„ÙŠÙ„'}</div>
        </div>
      `).join('');

      // Cache the result
      simpleCache.set('latestNotifications', alerts);
      
    } catch (error) {
      console.error("[Student Dashboard] Error loading notifications:", error);
      const notificationsContainer = document.getElementById('latestNotifications');
      if (notificationsContainer) {
        notificationsContainer.innerHTML = `
          <div class="empty-notifications">
            <p>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</p>
          </div>
        `;
      }
    }
  }

  // ğŸ“Š Calculate student progress based on attendance (period-aware) - OPTIMIZED
  async function calculateStudentProgress() {
    console.log("[Student Dashboard] Calculating student progress...");
    
    if (!currentEmail) {
      console.log("[Student Dashboard] No current user for progress calculation");
      return {
        percentage: 0,
        attendance: {
          combined: { present: 0, total: 0, percentage: 0 },
          period1: { present: 0, total: 0, percentage: 0 },
          period2: { present: 0, total: 0, percentage: 0 }
        }
      };
    }

    try {
      const emailKey = currentEmail.replace(/\./g, '_');
      
      // Check cache first
      const cachedProgress = simpleCache.get('studentProgress');
      if (cachedProgress) {
        console.log("[Student Dashboard] Using cached progress data");
        return cachedProgress;
      }
      
      // Get user data to get student name for attendance lookup
      const userSnapshot = await database.ref(`users/${emailKey}`).once('value');
      const userData = userSnapshot.val();
      
      if (!userData) {
        console.log("[Student Dashboard] No user data found for progress calculation");
        return {
          percentage: 0,
          attendance: {
            combined: { present: 0, total: 0, percentage: 0 },
            period1: { present: 0, total: 0, percentage: 0 },
            period2: { present: 0, total: 0, percentage: 0 }
          }
        };
      }

  const studentName = userData.username || userData.name || userData.fullName || userData.firstName || '';
  const firstNameToken = studentName ? studentName.split(' ')[0] : '';
      console.log("[Student Dashboard] Calculating progress for student:", studentName);

      // OPTIMIZED: Only fetch last 60 days of attendance instead of all
      const attendanceSnapshot = await database.ref('attendance').orderByKey().limitToLast(60).once('value');
      const attendanceData = attendanceSnapshot.val() || {};

      const periodStats = {
        period1: { present: 0, total: 0 },
        period2: { present: 0, total: 0 }
      };

      const matchesStudent = (record = {}) => {
        if (!record) return false;
        const recordId = record.studentId || record.id;
        const recordEmail = record.studentEmail || record.email;
        const recordName = record.studentName || record.name || '';
        const recordFirstToken = recordName ? recordName.split(' ')[0] : '';

        return recordId === emailKey ||
               recordEmail === currentEmail ||
               (recordName && studentName && (
                 recordName === studentName ||
                 (firstNameToken && recordName.includes(firstNameToken)) ||
                 (recordFirstToken && studentName.includes(recordFirstToken))
               ));
      };

      const collectStatsForPeriod = (periodKey, periodPayload) => {
        if (!periodPayload || typeof periodPayload !== 'object') {
          return;
        }

        const directRecord = periodPayload[emailKey];
        let studentRecord = directRecord;

        if (!studentRecord) {
          studentRecord = Object.values(periodPayload).find(matchesStudent);
        }

        if (studentRecord) {
          periodStats[periodKey].total += 1;
          if (studentRecord.status === 'present') {
            periodStats[periodKey].present += 1;
          }
        }
      };

      Object.values(attendanceData).forEach(dateData => {
        if (!dateData || typeof dateData !== 'object') {
          return;
        }

        const hasPeriods = dateData.period1 || dateData.period2;

        if (hasPeriods) {
          collectStatsForPeriod('period1', dateData.period1);
          collectStatsForPeriod('period2', dateData.period2);
        } else {
          // Legacy structure without periods, treat as period1
          collectStatsForPeriod('period1', dateData);
        }
      });

      const combinedPresent = periodStats.period1.present + periodStats.period2.present;
      const combinedTotal = periodStats.period1.total + periodStats.period2.total;
      const progressPercentage = combinedTotal > 0
        ? Math.min(Math.round((combinedPresent / combinedTotal) * 100), 100)
        : 0;

      const buildPercentage = (present, total) => total > 0
        ? Math.min(Math.round((present / total) * 100), 100)
        : 0;

      const attendanceSummary = {
        combined: {
          present: combinedPresent,
          total: combinedTotal,
          percentage: progressPercentage
        },
        period1: {
          present: periodStats.period1.present,
          total: periodStats.period1.total,
          percentage: buildPercentage(periodStats.period1.present, periodStats.period1.total)
        },
        period2: {
          present: periodStats.period2.present,
          total: periodStats.period2.total,
          percentage: buildPercentage(periodStats.period2.present, periodStats.period2.total)
        }
      };

      const result = {
        percentage: progressPercentage,
        attendance: attendanceSummary
      };

      console.log("[Student Dashboard] Progress calculation:", {
        studentName,
        attendance: attendanceSummary
      });

      // Cache the result for 30 seconds
      simpleCache.set('studentProgress', result);

      return result;

    } catch (error) {
      console.error("[Student Dashboard] Error calculating progress:", error);
      return {
        percentage: 0,
        attendance: {
          combined: { present: 0, total: 0, percentage: 0 },
          period1: { present: 0, total: 0, percentage: 0 },
          period2: { present: 0, total: 0, percentage: 0 }
        }
      };
    }
  }

  // ğŸ“Š Update progress display with manual refresh capability
  async function updateProgressDisplay() {
    console.log("[Student Dashboard] Updating progress display...");
    
    const progressFill = document.querySelector('.progress-fill');
    const progressText = document.querySelector('.progress-text');
    const studyProgress = document.querySelector('.study-progress');
    const refreshBtn = document.querySelector('.refresh-btn');
    
    // Show loading state
    if (progressText) {
      progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù…...';
    }
    if (progressFill) {
      progressFill.style.width = '0%';
      progressFill.parentElement.classList.add('loading-progress');
    }
    if (refreshBtn) {
      refreshBtn.style.transform = 'rotate(180deg)';
      refreshBtn.disabled = true;
    }
    
    // Clear cache to force fresh calculation
    simpleCache.set('studentProgress', null);
    
    try {
      const progressData = await calculateStudentProgress();

      const combined = progressData.attendance?.combined || { percentage: 0 };
      const period1 = progressData.attendance?.period1 || { present: 0, total: 0, percentage: 0 };
      const period2 = progressData.attendance?.period2 || { present: 0, total: 0, percentage: 0 };

      // Remove loading state
      if (progressFill && progressFill.parentElement) {
        progressFill.parentElement.classList.remove('loading-progress');
        
        // Animate progress bar
        setTimeout(() => {
          progressFill.style.width = combined.percentage + '%';
        }, 200);
      }
      
      if (progressText) {
        // Update progress text with detailed information
        progressText.innerHTML = `${combined.percentage}% ØªÙ‚Ø¯Ù…Ùƒ Ø§Ù„ÙƒÙ„ÙŠ`;
      }
      
      // Update the description with breakdown
      const progressDescription = studyProgress.querySelector('p');
      if (progressDescription) {
        let statusMessage = '';
        let statusColor = '#666';
        
        if (combined.percentage >= 90) {
          statusMessage = 'Ù…Ù…ØªØ§Ø²! Ø£Ù†Øª Ø¶Ù…Ù† Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø£ÙƒØ«Ø± ØªÙØ§Ø¹Ù„Ø§Ù‹ ğŸ‰';
          statusColor = '#388e3c';
        } else if (combined.percentage >= 75) {
          statusMessage = 'Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹! Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ğŸ‘';
          statusColor = '#2e7d32';
        } else if (combined.percentage >= 50) {
          statusMessage = 'Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø³ÙŠÙ†Ù‡ Ø£ÙƒØ«Ø± ğŸ’ª';
          statusColor = '#f57c00';
        } else if (combined.total === 0) {
          statusMessage = 'Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø£ÙŠ Ø­Ø¶ÙˆØ± Ø¨Ø¹Ø¯ ğŸ“…';
          statusColor = '#546e7a';
        } else {
          statusMessage = 'ØªØ­ØªØ§Ø¬ Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø­Ø¶ÙˆØ± ğŸ“š';
          statusColor = '#d32f2f';
        }
        
        progressDescription.innerHTML = `
          <div style="color: ${statusColor}; margin-bottom: 10px; font-weight: bold;">
            ${statusMessage}
          </div>
          <div style="font-size: 0.9em; line-height: 1.7;">
            â€¢ Ø§Ù„Ø­Ø¶ÙˆØ±: ${period1.present} Ù…Ù† ${period1.total} ÙŠÙˆÙ… (${period1.percentage}%) Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰<br>
            â€¢ Ø§Ù„Ø­Ø¶ÙˆØ±: ${period2.present} Ù…Ù† ${period2.total} ÙŠÙˆÙ… (${period2.percentage}%) Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
          </div>
          <div style="font-size: 0.85em; margin-top: 10px; color: #607d8b;">
            ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙÙ‚Ø·.
          </div>
        `;
        progressDescription.style.color = '#666';
        progressDescription.style.marginTop = '15px';
      }
      
      console.log("[Student Dashboard] Progress display updated:", progressData);
      
    } catch (error) {
      console.error("[Student Dashboard] Error updating progress display:", error);
      
      if (progressText) {
        progressText.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù…';
      }
      if (progressFill) {
        progressFill.parentElement.classList.remove('loading-progress');
        progressFill.style.width = '0%';
      }
    } finally {
      // Reset refresh button
      if (refreshBtn) {
        setTimeout(() => {
          refreshBtn.style.transform = 'rotate(0deg)';
          refreshBtn.disabled = false;
        }, 500);
      }
    }
  }

  // Mobile menu toggle function
  function toggleMobileMenu() {
    const navMenu = document.getElementById('navMenu');
    navMenu.classList.toggle('active');
  }

  // ğŸ”“ Logout
  function logout() {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
        clearSession();
        window.location.href = "index.html";
      }
    }

  // Close mobile menu when clicking on a link
  document.addEventListener('DOMContentLoaded', function() {
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
      link.addEventListener('click', function() {
        const navMenu = document.getElementById('navMenu');
        navMenu.classList.remove('active');
      });
    });
  });

  // Performance monitoring
  window.addEventListener('load', function() {
    console.log('[Student Dashboard] Page loaded with optimized one-time queries');
  });

// cross background animation
const container = document.querySelector('.cross-background');

  const svgCross = `
  <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!-- License: CC0. Made by SVG Repo: https://www.svgrepo.com/svg/90761/cross -->
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 60 60" style="enable-background:new 0 0 60 60;" xml:space="preserve">
<path d="M52.247,19.665c-0.396,0-0.785,0.049-1.162,0.145c-0.403-2.214-2.347-3.897-4.675-3.897c-2.396,0-4.382,1.781-4.707,4.087
	H35v-4.811c2.077-0.517,3.594-2.381,3.594-4.599c0-2.188-1.486-4.036-3.503-4.586c0.11-0.404,0.167-0.824,0.167-1.251
	C35.258,2.132,33.126,0,30.506,0c-2.621,0-4.753,2.132-4.753,4.753c0,0.395,0.049,0.785,0.145,1.162C23.684,6.318,22,8.262,22,10.59
	c0,2.364,1.735,4.331,4,4.693V20h-7.812c-0.516-2.077-2.38-3.594-4.599-3.594c-2.188,0-4.035,1.486-4.585,3.503
	c-0.405-0.11-0.825-0.167-1.252-0.167C5.132,19.742,3,21.874,3,24.495s2.132,4.753,4.753,4.753c0.396,0,0.785-0.049,1.162-0.145
	C9.318,31.316,11.262,33,13.59,33c2.365,0,4.332-1.736,4.693-4H26v15.84c-2.026,0.551-3.506,2.405-3.506,4.569
	c0,2.188,1.486,4.036,3.502,4.586c-0.11,0.405-0.167,0.825-0.167,1.252c0,2.621,2.132,4.752,4.753,4.752s4.753-2.132,4.753-4.752
	c0-0.395-0.049-0.785-0.146-1.162c2.215-0.404,3.898-2.347,3.898-4.676c0-2.395-1.781-4.382-4.088-4.706V29h6.84
	c0.552,2.027,2.406,3.506,4.57,3.506c2.188,0,4.035-1.486,4.585-3.503c0.405,0.11,0.825,0.167,1.252,0.167
	c2.621,0,4.753-2.132,4.753-4.752S54.868,19.665,52.247,19.665z"/>
</svg>

  `;

 const isMobile = window.innerWidth < 768;
const crossCount = isMobile ? 10 : 25;

for (let i = 0; i < crossCount; i++) {
  const cross = document.createElement('div');
  cross.className = 'cross';
  cross.innerHTML = svgCross;
  cross.style.left = Math.random() * 100 + 'vw';
  cross.style.top = Math.random() * 100 + 'vh';
  cross.style.animationDuration = (12 + Math.random() * 11) + 's';
  container.appendChild(cross);
}
</script>

</body>
</html>