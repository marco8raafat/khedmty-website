<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="logoCircle1.png">
  <title>ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠÙŠÙ† - Firebase Auth</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Cairo', 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      direction: rtl;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }

    h1 {
      color: #233B6E;
      margin-bottom: 10px;
      font-size: 2em;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1em;
    }

    .info-box {
      background: #d1ecf1;
      border: 2px solid #0c5460;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
      color: #0c5460;
    }

    .info-box h3 {
      margin-bottom: 10px;
      color: #0c5460;
    }

    .password-input {
      margin-bottom: 20px;
    }

    .password-input label {
      display: block;
      margin-bottom: 10px;
      color: #233B6E;
      font-weight: bold;
      font-size: 1.1em;
    }

    .password-input input {
      width: 100%;
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 1.1em;
      transition: border-color 0.3s;
    }

    .password-input input:focus {
      outline: none;
      border-color: #233B6E;
    }

    .password-hint {
      margin-top: 8px;
      color: #666;
      font-size: 0.9em;
    }

    .button-group {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
    }

    button {
      flex: 1;
      padding: 15px 30px;
      font-size: 1.1em;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      color: white;
    }

    .btn-primary {
      background: linear-gradient(135deg, #233B6E, #314d9f);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(35, 59, 110, 0.4);
    }

    .btn-primary:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: #6c757d;
    }

    .btn-secondary:hover {
      background: #5a6268;
      transform: translateY(-2px);
    }

    #progress {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      max-height: 400px;
      overflow-y: auto;
      display: none;
    }

    #progress.show {
      display: block;
    }

    #progress h2 {
      color: #233B6E;
      margin-bottom: 15px;
      position: sticky;
      top: 0;
      background: #f8f9fa;
      padding: 10px 0;
    }

    .progress-item {
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      font-size: 0.95em;
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .success {
      background: #d4edda;
      color: #155724;
      border-right: 4px solid #28a745;
    }

    .warning-item {
      background: #fff3cd;
      color: #856404;
      border-right: 4px solid #ffc107;
    }

    .error {
      background: #f8d7da;
      color: #721c24;
      border-right: 4px solid #dc3545;
    }

    .info {
      background: #d1ecf1;
      color: #0c5460;
      border-right: 4px solid #17a2b8;
    }

    .summary {
      background: white;
      border: 3px solid #233B6E;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
    }

    .summary h2 {
      color: #233B6E;
      margin-bottom: 15px;
    }

    .summary-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .stat-box {
      text-align: center;
      padding: 15px;
      border-radius: 8px;
      font-weight: bold;
    }

    .stat-success {
      background: #d4edda;
      color: #155724;
    }

    .stat-warning {
      background: #fff3cd;
      color: #856404;
    }

    .stat-error {
      background: #f8d7da;
      color: #721c24;
    }

    .stat-total {
      background: #d1ecf1;
      color: #0c5460;
    }

    .back-link {
      display: block;
      text-align: center;
      margin-top: 20px;
      color: #233B6E;
      text-decoration: none;
      font-weight: bold;
    }

    .back-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠÙŠÙ† (110 Ù…Ø³ØªØ®Ø¯Ù…)</h1>
    <p class="subtitle">Ø§Ø³ØªÙƒÙ…Ø§Ù„ ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ 100</p>

    <div class="info-box">
      <h3>ğŸ“‹ Ù…Ø§ ØªÙØ¹Ù„Ù‡ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø©:</h3>
      <ul style="margin-right: 20px; line-height: 1.8;">
        <li>ØªØ®Ø·ÙŠ Ø£ÙˆÙ„ 100 Ù…Ø³ØªØ®Ø¯Ù… (ØªÙ… ØªØ±Ø­ÙŠÙ„Ù‡Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹)</li>
        <li>ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù€ 110 Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠÙŠÙ†</li>
        <li>ØªØ®Ø·ÙŠ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… ØªÙ… ØªØ±Ø­ÙŠÙ„Ù‡ Ø¨Ø§Ù„ÙØ¹Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</li>
        <li>Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„ Ø¹Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬</li>
      </ul>
    </div>

    <div class="password-input">
      <label for="tempPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¤Ù‚ØªØ© (Ù†ÙØ³ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©):</label>
      <input 
        type="text" 
        id="tempPassword" 
        placeholder="Khedmty2025!"
        value="Khedmty2025!"
      >
      <p class="password-hint">
        ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„ØªÙŠ Ø§Ø³ØªØ®Ø¯Ù…ØªÙ‡Ø§ ÙÙŠ Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚
      </p>
    </div>

    <div class="password-input">
      <label for="skipCount">ØªØ®Ø·ÙŠ Ø£ÙˆÙ„ ÙƒÙ… Ù…Ø³ØªØ®Ø¯Ù…:</label>
      <input 
        type="number" 
        id="skipCount" 
        value="100"
        min="0"
        max="250"
      >
      <p class="password-hint">
        ğŸ’¡ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© 100 (Ù„ØªØ®Ø·ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ÙØ±Ø­Ù‘Ù„ÙŠÙ†)
      </p>
    </div>

    <div class="password-input">
      <label for="delayTime">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø¨ÙŠÙ† ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù… (Ø¨Ø§Ù„Ø«Ø§Ù†ÙŠØ©):</label>
      <input 
        type="number" 
        id="delayTime" 
        value="2"
        min="1"
        max="10"
        step="0.5"
      >
      <p class="password-hint">
        ğŸ’¡ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙˆÙ‚Øª ØªÙ‚Ù„Ù„ Ù…Ù† Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ù„Ø­Ø¸Ø± Ø§Ù„Ù…Ø¤Ù‚Øª (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: 2 Ø«Ø§Ù†ÙŠØ©)
      </p>
    </div>

    <div class="password-input">
      <label for="batchSize">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ ÙƒÙ„ Ø¯ÙØ¹Ø©:</label>
      <input 
        type="number" 
        id="batchSize" 
        value="20"
        min="5"
        max="50"
      >
      <p class="password-hint">
        ğŸ’¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ù„Ù‰ Ø¯ÙØ¹Ø§Øª ØµØºÙŠØ±Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø­Ø¸Ø± (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: 20 Ù…Ø³ØªØ®Ø¯Ù…)
      </p>
    </div>

    <div class="button-group">
      <button class="btn-primary" id="startBtn" onclick="startMigration()">
        ğŸš€ Ø¨Ø¯Ø¡ ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚ÙŠ (110 Ù…Ø³ØªØ®Ø¯Ù…)
      </button>
      <button class="btn-secondary" onclick="window.location.href='teacherDashboard.html'">
        ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
      </button>
    </div>

    <div id="progress">
      <h2>ğŸ“Š Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h2>
      <div id="progressContent"></div>
    </div>

    <a href="index.html" class="back-link">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDwcSo_bhqO5svMl3kAL8N1c91nvEZ_sac",
      authDomain: "edad-5odam.firebaseapp.com",
      databaseURL: "https://edad-5odam-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "edad-5odam",
      storageBucket: "edad-5odam.appspot.com",
      messagingSenderId: "679576633778",
      appId: "1:679576633778:web:566e6aaef9b72f71a824ab"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const auth = firebase.auth();

    let migrationInProgress = false;

    function addProgressItem(message, type = 'info') {
      const progressContent = document.getElementById('progressContent');
      const item = document.createElement('div');
      item.className = `progress-item ${type}`;
      item.innerHTML = message;
      progressContent.appendChild(item);
      
      // Auto-scroll to bottom
      progressContent.scrollTop = progressContent.scrollHeight;
    }

    async function startMigration() {
      if (migrationInProgress) {
        alert('Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¬Ø§Ø±ÙŠØ© Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...');
        return;
      }

      const tempPassword = document.getElementById('tempPassword').value.trim();
      const skipCount = parseInt(document.getElementById('skipCount').value) || 0;
      const delayTime = parseFloat(document.getElementById('delayTime').value) || 2;
      const batchSize = parseInt(document.getElementById('batchSize').value) || 20;
      
      if (!tempPassword || tempPassword.length < 6) {
        alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
        return;
      }

      if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ±Ø­ÙŠÙ„ØŸ\n\nØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:\nâ€¢ ØªØ®Ø·ÙŠ Ø£ÙˆÙ„ ${skipCount} Ù…Ø³ØªØ®Ø¯Ù…\nâ€¢ Ø§Ù„ØªØ£Ø®ÙŠØ± Ø¨ÙŠÙ† ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…: ${delayTime} Ø«Ø§Ù†ÙŠØ©\nâ€¢ Ø­Ø¬Ù… Ø§Ù„Ø¯ÙØ¹Ø©: ${batchSize} Ù…Ø³ØªØ®Ø¯Ù…\nâ€¢ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: "${tempPassword}"`)) {
        return;
      }

      migrationInProgress = true;
      const startBtn = document.getElementById('startBtn');
      const progressDiv = document.getElementById('progress');
      const progressContent = document.getElementById('progressContent');
      
      startBtn.disabled = true;
      startBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ±Ø­ÙŠÙ„...';
      progressDiv.classList.add('show');
      progressContent.innerHTML = '';

      addProgressItem('ğŸ”„ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠÙŠÙ†...', 'info');
      addProgressItem('ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...', 'info');

      try {
        // Get all users from database
        const usersSnapshot = await database.ref('users').once('value');
        const usersData = usersSnapshot.val() || {};
        
        const users = Object.entries(usersData);
        let successCount = 0;
        let errorCount = 0;
        let skippedDuplicate = 0;
        let skippedManually = 0;

        addProgressItem(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${users.length} Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`, 'success');
        addProgressItem(`â­ï¸ Ø³ÙŠØªÙ… ØªØ®Ø·ÙŠ Ø£ÙˆÙ„ ${skipCount} Ù…Ø³ØªØ®Ø¯Ù… (ØªÙ… ØªØ±Ø­ÙŠÙ„Ù‡Ù… Ø³Ø§Ø¨Ù‚Ø§Ù‹)`, 'warning-item');
        addProgressItem(`â±ï¸ Ø§Ù„ØªØ£Ø®ÙŠØ± Ø¨ÙŠÙ† ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…: ${delayTime} Ø«Ø§Ù†ÙŠØ©`, 'info');
        addProgressItem(`ğŸ“¦ Ø­Ø¬Ù… Ø§Ù„Ø¯ÙØ¹Ø©: ${batchSize} Ù…Ø³ØªØ®Ø¯Ù…`, 'info');
        addProgressItem('', 'info'); // Spacer
        addProgressItem(`ğŸ” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¤Ù‚ØªØ©: <strong>${tempPassword}</strong>`, 'info');
        addProgressItem('', 'info'); // Spacer

        let currentBatch = 0;
        const totalBatches = Math.ceil((users.length - skipCount) / batchSize);

        for (let i = 0; i < users.length; i++) {
          const [emailKey, userData] = users[i];
          
          // Convert email key back to normal email
          const email = emailKey.replace(/_/g, '.');
          const userName = userData.username || userData.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
          const userRole = userData.role || 'student';
          
          // Skip first N users
          if (i < skipCount) {
            skippedManually++;
            if (i % 10 === 0 || i === skipCount - 1) {
              addProgressItem(
                `â­ï¸ ØªØ®Ø·ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ${i - 9 >= 0 ? i - 9 + 1 : 1} Ø¥Ù„Ù‰ ${i + 1} - ØªÙ… Ù…Ø³Ø¨Ù‚Ø§Ù‹`,
                'info'
              );
            }
            continue;
          }

          // Check if we need to pause between batches
          const positionInBatch = (i - skipCount) % batchSize;
          const batchNumber = Math.floor((i - skipCount) / batchSize) + 1;
          
          if (positionInBatch === 0 && batchNumber > currentBatch) {
            currentBatch = batchNumber;
            addProgressItem(`ğŸ“¦ Ø¨Ø¯Ø¡ Ø§Ù„Ø¯ÙØ¹Ø© ${batchNumber}/${totalBatches}`, 'info');
            
            // Pause for 5 seconds between batches (except first batch)
            if (batchNumber > 1) {
              addProgressItem(`â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª Ù„Ù…Ø¯Ø© 5 Ø«ÙˆØ§Ù†ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø¯ÙØ¹Ø§Øª...`, 'warning-item');
              await new Promise(resolve => setTimeout(resolve, 5000));
            }
          }
          
          try {
            // Create Firebase Auth account
            await auth.createUserWithEmailAndPassword(email, tempPassword);
            
            successCount++;
            addProgressItem(
              `âœ… ${i + 1}/${users.length}: ØªÙ… ØªØ±Ø­ÙŠÙ„ <strong>${userName}</strong> (${email}) - ${userRole}`,
              'success'
            );
            
          } catch (error) {
            if (error.code === 'auth/email-already-exists') {
              skippedDuplicate++;
              addProgressItem(
                `âš ï¸ ${i + 1}/${users.length}: <strong>${userName}</strong> (${email}) - Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„`,
                'warning-item'
              );
            } else if (error.code === 'auth/too-many-requests') {
              errorCount++;
              addProgressItem(
                `ğŸ›‘ ${i + 1}/${users.length}: <strong>${userName}</strong> - ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ø¤Ù‚ØªØ§Ù‹!`,
                'error'
              );
              addProgressItem(
                `âš ï¸ Firebase Ø­Ø¸Ø± Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ø¤Ù‚ØªØ§Ù‹. Ø§Ù†ØªØ¸Ø± 15 Ø¯Ù‚ÙŠÙ‚Ø© Ø«Ù… Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¯Ø¡Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${i + 1}`,
                'error'
              );
              addProgressItem(
                `ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø§Ø³ØªØ®Ø¯Ù… "ØªØ®Ø·ÙŠ Ø£ÙˆÙ„ ${i} Ù…Ø³ØªØ®Ø¯Ù…" Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©`,
                'warning-item'
              );
              // Stop the migration
              throw new Error('ØªÙ… Ø§Ù„Ø­Ø¸Ø± Ø§Ù„Ù…Ø¤Ù‚Øª - ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± 15 Ø¯Ù‚ÙŠÙ‚Ø©');
            } else if (error.code === 'auth/invalid-email') {
              errorCount++;
              addProgressItem(
                `âŒ ${i + 1}/${users.length}: <strong>${userName}</strong> (${email}) - Ø¨Ø±ÙŠØ¯ ØºÙŠØ± ØµØ§Ù„Ø­`,
                'error'
              );
            } else if (error.code === 'auth/weak-password') {
              errorCount++;
              addProgressItem(
                `âŒ ${i + 1}/${users.length}: <strong>${userName}</strong> - ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©`,
                'error'
              );
            } else {
              errorCount++;
              addProgressItem(
                `âŒ ${i + 1}/${users.length}: <strong>${userName}</strong> - ${error.message}`,
                'error'
              );
            }
          }

          // Add delay between each user (converted to milliseconds)
          await new Promise(resolve => setTimeout(resolve, delayTime * 1000));
        }

        // Show final summary
        const totalProcessed = users.length - skippedManually;
        progressContent.innerHTML += `
          <div class="summary">
            <h2>ğŸ“Š Ù…Ù„Ø®Øµ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ±Ø­ÙŠÙ„</h2>
            <div class="summary-stats">
              <div class="stat-box stat-success">
                <div style="font-size: 2em;">âœ…</div>
                <div>Ù†Ø¬Ø­</div>
                <div style="font-size: 1.5em;">${successCount}</div>
              </div>
              <div class="stat-box stat-warning">
                <div style="font-size: 2em;">âš ï¸</div>
                <div>Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹</div>
                <div style="font-size: 1.5em;">${skippedDuplicate}</div>
              </div>
              <div class="stat-box stat-error">
                <div style="font-size: 2em;">âŒ</div>
                <div>ÙØ´Ù„</div>
                <div style="font-size: 1.5em;">${errorCount}</div>
              </div>
              <div class="stat-box stat-total">
                <div style="font-size: 2em;">ğŸ“</div>
                <div>ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡</div>
                <div style="font-size: 1.5em;">${totalProcessed}</div>
              </div>
            </div>
            ${skippedManually > 0 ? `
            <div style="margin-top: 15px; padding: 10px; background: #d1ecf1; border-radius: 8px; color: #0c5460; text-align: center;">
              <strong>â­ï¸ ØªÙ… ØªØ®Ø·ÙŠ ${skippedManually} Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¯ÙˆÙŠØ§Ù‹ (ØªÙ… ØªØ±Ø­ÙŠÙ„Ù‡Ù… ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)</strong>
            </div>` : ''}
            <div style="margin-top: 20px; padding: 15px; background: #d4edda; border-radius: 8px; color: #155724;">
              <strong>âœ… Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ÙØ±Ø­Ù‘Ù„ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©: ${successCount}</strong><br>
              <strong>ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¢Ù†: ${successCount + skippedManually + skippedDuplicate}</strong>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; color: #856404;">
              <strong>ğŸ“Œ Ø®Ø·ÙˆØ§Øª Ù…Ù‡Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±Ø­ÙŠÙ„:</strong>
              <ol style="margin: 10px 0 0 20px; line-height: 1.8;">
                <li>ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù€ ${successCount} Ø§Ù„Ø¬Ø¯Ø¯ Ø¨ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¤Ù‚ØªØ©: <strong style="font-family: monospace;">${tempPassword}</strong></li>
                <li>Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¹Ø¯ Firebase Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ù…Ø§Ù† (Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø¨Ø¹Ø¯)</li>
                <li>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù€ 210 Ø£ØµØ¨Ø­ÙˆØ§ Ø§Ù„Ø¢Ù† ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…!</li>
              </ol>
            </div>
          </div>
        `;

        startBtn.textContent = 'âœ… Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­';
        startBtn.style.background = '#28a745';

      } catch (error) {
        addProgressItem(`âŒ Ø®Ø·Ø£ Ø®Ø·ÙŠØ±: ${error.message}`, 'error');
        startBtn.disabled = false;
        startBtn.textContent = 'ğŸš€ Ø¨Ø¯Ø¡ ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚ÙŠ (110 Ù…Ø³ØªØ®Ø¯Ù…)';
      } finally {
        migrationInProgress = false;
      }
    }
  </script>
</body>
</html>
